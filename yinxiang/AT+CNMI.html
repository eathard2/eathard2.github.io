<html>
<head>
  <title>AT+CNMI</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="936"/>
<h1>AT+CNMI</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/5/20 22:16</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://www.360doc.com/content/12/0717/10/7899729_224679553.shtml"><i>http://www.360doc.com/content/12/0717/10/7899729_224679553.shtml</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div><div style="font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;font-size:12px;text-align:center;background-color:rgb(255, 255, 255);"><div style="font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;"><div style="font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;"><div style="font-family:'microsoft yahei', arial, simsun;">
<div style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;height:17px;">
<div style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;width:17px;height:17px;float:right;position:relative;margin-left:10px;">
<img src="AT+CNMI_files/bgcolor.jpg" type="image/jpeg" height="17" style="margin:0px;padding:0px;border:none;" width="17"/>

</div>
<div style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;width:17px;height:17px;float:right;position:relative;">
<img src="AT+CNMI_files/fontSize.jpg" type="image/jpeg" height="17" style="margin:0px;padding:0px;border:none;" width="17"/>

</div>
</div>
<h2 style="padding:0px;font-size:30px;font-family:simhei;color:rgb(0, 0, 0);line-height:40px;margin:12px 0px 25px;max-height:80px;overflow:hidden;text-align:left;word-break:break-all;">AT+CNMI</h2>
<div style="margin:0px;padding:0px;font-family:'microsoft yahei', arial, simsun;height:35px;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(239, 239, 239);position:relative;z-index:2;">
<div style="height:25px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;padding:0px;margin:0px;color:rgb(112, 112, 112);float:left;margin-top:10px;z-index:2;font-size:13px;text-align:left;position:relative;">
2012-07-17
<span style="vertical-align:bottom;"> <a href="http://www.360doc.com/userhome/7899729" style="color:rgb(84, 123, 60);text-decoration:none;outline:0px;" target="_blank">若渴若愚</a>
</span>
<span>
<span>  阅 2784 </span><span><span style="cursor:pointer;"> 转 <span style="cursor:pointer;">12</span></span>
<span></span>
</span>
</span>
</div>
<div style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;float:right;width:262px;height:35px;position:relative;"><div style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;width:100%;height:auto;overflow:hidden;"><a href="#" style="height:35px;background:url(&quot;http://pubimage.360doc.com/NewArticle/btnico_cang.png&quot;) 0% 50% no-repeat;outline:0px;width:124px;float:right;text-decoration:none;display:block;overflow:hidden;text-align:right;line-height:35px;font-size:13px;color:rgb(112, 112, 112);">转藏到我的图书馆</a><div style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;float:right;width:25px;height:35px;cursor:pointer;overflow:hidden;"><span style="width:0px;height:0px;overflow:hidden;line-height:0px;font-size:0px;border-color:rgb(51, 51, 51) transparent transparent;display:block;border-style:solid dashed dashed;border-width:5px;margin:16px 0px 0px 4px;"></span></div><a href="#" style="height:35px;background:url(&quot;http://pubimage.360doc.com/NewArticle/btnico_wx.png&quot;) 0% 50% no-repeat;outline:0px;width:55px;float:right;text-decoration:none;display:block;overflow:hidden;text-align:right;line-height:35px;font-size:13px;color:rgb(112, 112, 112);">微信</a> <span style="float:right;height:35px;line-height:35px;color:rgb(112, 112, 112);cursor:pointer;font-size:13px;">分享：</span></div></div>
</div>
<div style="text-align:left;margin:0px;padding:10px 0px 0px;height:auto;overflow:hidden;font-size:16px;word-break:break-all;color:rgb(47, 47, 47);line-height:1.5;float:left;position:relative;font-family:'microsoft yahei', arial, simsun;">
<table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;">
<tbody>
<tr>
<td style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;min-width:656px;">
<div style="font-family:inherit;margin:0;padding:0;width:656px;height:0;"></div>
<div style="margin:0px;padding:0px;font-family:inherit;">
<div style="margin:0px;padding:0px;font-family:inherit;"><span style="font-family:inherit;color:rgb(0, 128, 0);font-size:24px;font-weight:bold;line-height:36px;">AT+CNMI</span></div></div>
<div style="margin:0px;padding:0px;font-family:inherit;">
<p style="font-family:inherit;"><font color="#008000">短消息类（class）的概念：根据指定存储的位置，短消息分为class0－3四个类，也可以不指定类别（no
class），由移动设备按默认设置进行处理，存储到内存或者SIM卡中。在TPDU的TP－DCS字节中，当bit7－bit4为00x1、1111时，bit1－bit0指示消息所属类。
</font></p>
<p style="font-family:inherit;"><font color="#008000">00——class 0，可直接显示。</font></p>
<p style="font-family:inherit;"><font color="#008000">01——class 1，默认储存在ME内存中。</font></p>
<p style="font-family:inherit;"><font color="#008000">02——class 2，储存在SIM卡中。</font></p>
<p style="font-family:inherit;"><font color="#008000">03——class 3，可直接传输到终端设备TE。</font></p>
<p style="font-family:inherit;"><font color="#008000">默认的短消息存在SIM卡中，无类别的短消息通常也存在SIM卡中。 </font></p>
<p style="font-family:inherit;"><font color="#008000">GSM
Modem一般都支持一条“AT＋CNMI”指令，用于设定当有某类短消息到达时，如何处理它——只储存在制定的内存（易失的/非易失的）中；先储存后通知TE；直接转发到TE，等等。
</font></p>
<p style="font-family:inherit;"><font color="#008000">“AT＋CNMI”指令语法为：</font></p>
<p style="font-family:inherit;"><font color="#008000">AT＋CNMI＝＜mode＞，＜mt＞，＜bm＞，＜ds＞，＜bfr＞ </font></p>
<p style="font-family:inherit;"><font color="#008000">（1）＜mode＞控制通知TE的方式。</font></p>
<p style="font-family:inherit;"><font color="#008000">0——先将通知缓存起来，再按照＜mt＞的值进行发送。 </font></p>
<p style="font-family:inherit;"><font color="#008000">1——在数据线空闲的情况下，通知TE，否则，不通知TE。 </font></p>
<p style="font-family:inherit;"><font color="#008000">2——数据线空闲时，直接通知TE；否则先将通知缓存起来，待数据线空闲时再行发送。 </font></p>
<p style="font-family:inherit;"><font color="#008000">3——直接通知TE。在数据线被占用的情况下，通知TE的消息将混合在数据中一起传输。 </font></p>
<p style="font-family:inherit;"><font color="#008000">（2）＜mt＞设置短消息存储和通知TE的内容。</font></p>
<p style="font-family:inherit;"><font color="#008000">0——接受的短消息存储到默认的内存位置（包括class 3），不通知TE。</font></p>
<p style="font-family:inherit;"><font color="#008000">1——接收的短消息储存到默认的内存位置，并且向TE发出通知（包括class 3）。通知的形式为： </font></p>
<p style="font-family:inherit;"><font color="#008000">＋CMTI：”SM”，＜index＞ </font></p>
<p style="font-family:inherit;"><font color="#008000">2——对于class 2短消息，储存到SIM卡，并且向TE发出通知；对于其他class，直接将短消息转发到TE： </font></p>
<p style="font-family:inherit;"><font color="#008000">＋CMT：[＜alpha＞]，＜length＞＜CR＞＜LF＞＜pdu＞（PDU模式） </font></p>
<p style="font-family:inherit;"><font color="#008000">或者＋CMT：＜oa＞，[＜alpha＞，]＜scts＞[，＜tooa＞，＜fo＞，＜pid＞，＜dcs＞，＜sca＞，＜tosca＞，＜length＞]＜CR＞＜LF＞＜data＞（text模式）
</font></p>
<p style="font-family:inherit;"><font color="#008000">3——对于class 3短消息，直接转发到TE，同＜mt＞＝2；对于其他class，同＜mt＞＝1。 </font></p>
<p style="font-family:inherit;"><font color="#008000">（3）bm、ds、bfr的含义，请参考相关标准文档。一般不需要去关心它们，设置为0即可。 </font></p>
<p style="font-family:inherit;"><font color="#008000">综合以上分析，若使短消息不经过SIM卡，直接发送至TE，可以设置： </font></p>
<p style="font-family:inherit;"><font color="#008000">AT＋CNMI＝2，2，0，0，0 </font></p>
<p style="font-family:inherit;"><font color="#008000">但是这样还有一个问题，class
2的短信，还是会存入SIM卡中，并发送＋CMTI：”SM”，＜index＞。那么，接收程序需要处理短信通知和内容两种情况，增加了复杂性。如果发送方也由程序控制，可以只发no
class和class 1的短信。这里选用no class的配置。PDU模式下，令TP－DCS的bit7－bit4为00x0，即可设置发送的短信为no
class。通常用手机发送的短信，也是无类别的。</font></p>
<p style="font-family:inherit;"><font color="#008000">通信时，发送接收双方要统一短信格式。在发送方设置AT＋CMGF＝0，确定短信发送格式为PDU方式。</font></p>
<p style="font-family:inherit;"><font color="#008000">在接收方设置： </font></p>
<p style="font-family:inherit;"><font color="#008000">AT＋CMGF＝0 //短信接收格式为PDU方式 </font></p>
<p style="font-family:inherit;"><font color="#008000">AT＋CSMS＝0 </font></p>
<p style="font-family:inherit;"><font color="#008000">如果AT＋CSMS＝1，接收到短信时，TE需在一定的时间内发送反馈消息至模块；若超时，＜mode＞和＜mt＞的值会强制复位到0。那么，再有新的短信将不能被正确处理，需要用“AT＋CNMI”指令重新设置参数才行。这增加了程序处理的复杂性。AT＋CSMS＝0时，省去了这些麻烦。</font></p><p style="font-family:inherit;"><font color="#008000"><br/></font></p><p style="font-family:inherit;"><font color="#008000"></font></p><p style="font-family:inherit;text-indent:21pt;margin-left:42pt;"><font color="#008000"><b><span style="font-family:宋体;mso-bidi-font-size:10.5pt;"><b><span style="font-family:宋体;mso-bidi-font-size:10.5pt;"></span></b>命 令<span lang="EN-US" style="font-family:inherit;" xml:lang="EN-US">:</span></span></b></font></p><font color="#008000">
<p style="font-family:inherit;text-indent:26.25pt;margin-left:63pt;mso-para-margin-left:6.0gd;mso-char-indent-count:2.5;"><span lang="EN-US" style="font-family:宋体;mso-bidi-font-size:10.5pt;" xml:lang="EN-US">AT+CNMI=2,1,0,0,0<span style="font-family:inherit;"> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></span>
//&lt;mt&gt;=1</span></p>
<p style="font-family:inherit;text-indent:21pt;margin-left:42pt;"><b><span style="font-family:宋体;mso-bidi-font-size:10.5pt;">响 应<span lang="EN-US" style="font-family:inherit;" xml:lang="EN-US">:</span></span></b></p>
<p style="font-family:inherit;text-indent:26.25pt;margin-left:63pt;mso-para-margin-left:6.0gd;mso-char-indent-count:2.5;"><span lang="EN-US" style="font-family:宋体;mso-bidi-font-size:10.5pt;" xml:lang="EN-US">OK</span></p>
<p style="font-family:inherit;text-indent:21pt;margin-left:42pt;"><b><span style="font-family:宋体;mso-bidi-font-size:10.5pt;">响 应<span lang="EN-US" style="font-family:inherit;" xml:lang="EN-US">:</span></span></b></p>
<p style="font-family:inherit;text-indent:26.25pt;margin-left:63pt;mso-para-margin-left:6.0gd;mso-char-indent-count:2.5;"><span lang="EN-US" style="font-family:宋体;mso-bidi-font-size:10.5pt;" xml:lang="EN-US">+CMTI : &quot;SM&quot;, 1<span style="font-family:inherit;"> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></span>
//</span><span style="font-family:宋体;mso-bidi-font-size:10.5pt;">收到新消息的提示</span></p></font><p style="font-family:inherit;"></p><p style="font-family:inherit;"><font color="#008000"><br/></font></p></div>
</td>

</tr>
</tbody>
</table>

</div>
<table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;">
<tbody>
<tr>
<td style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;">
<ul style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;list-style:none;"></ul>
</td>
</tr>
</tbody>
</table>
<div style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;"></div>
<span></span>
<a style="text-decoration:none;outline:0px;"></a>
<p style="margin:0;padding:0;"></p>
<p style="clear:both;width:100%;height:0px;font-size:0px;overflow:hidden;margin:0px;padding:0px;"></p>
<div style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;height:39px;text-align:left;position:relative;z-index:3;">
<div style="width:100%;height:auto;overflow:visible;margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;">
<a href="#" style="font-family:'Microsoft YaHei';background-position:0px 0px;border-radius:2px;outline:0px;text-decoration:none;padding:0px 14px 0px 34px;line-height:36px;font-size:14px;height:36px;float:left;display:inline-block;margin:0px 2px;background-image:url(&quot;http://pubimage.360doc.com/NewArticle/btn_icon1.gif&quot;);background-color:rgb(255, 255, 255);background-repeat:no-repeat;color:rgb(0, 0, 0);">转藏到我的图书馆</a>
<a href="#" style="font-family:'Microsoft YaHei';background-position:0px -75px;position:relative;padding:0px 14px 0px 34px;float:left;line-height:36px;display:inline-block;font-size:14px;text-decoration:none;border-radius:2px;height:36px;margin:0px 2px;background-image:url(&quot;http://pubimage.360doc.com/NewArticle/btn_icon1.gif&quot;);background-color:rgb(255, 255, 255);background-repeat:no-repeat;outline:0px;color:rgb(0, 0, 0);">献花（<span>0</span>）

</a>
<span style="float:left;display:inline-block;height:36px;line-height:36px;font-size:14px;cursor:pointer;margin-left:10px;">分享：</span>
<a href="#" style="height:36px;color:rgb(0, 0, 0);float:left;outline:0px;display:inline-block;text-decoration:none;text-align:right;width:55px;line-height:36px;font-size:14px;background:url(&quot;http://pubimage.360doc.com/NewArticle/btnico_wx.png&quot;) 0% 50% no-repeat;">微信</a>
<div style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;float:left;width:25px;height:35px;cursor:pointer;overflow:hidden;"><span style="width:0px;height:0px;overflow:hidden;line-height:0px;font-size:0px;border-color:rgb(51, 51, 51) transparent transparent;display:block;border-style:solid dashed dashed;border-width:5px;margin:16px 0px 0px 4px;"></span></div>
</div>

</div>
<div style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;height:28px;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(239, 239, 239);">
<p style="overflow:hidden;list-style:none outside;padding:0px;font-family:'microsoft yahei', arial, simsun;width:60%;height:auto;margin:0px;font-size:13px;color:rgb(112, 112, 112);text-align:left;float:left;margin-top:4px;">
来自：
<span style="list-style:none outside;margin:0px;padding:0px;font-family:'microsoft yahei', arial, simsun;vertical-align:bottom;width:auto;">
<a href="http://www.360doc.com/userhome/7899729" style="list-style:none outside;margin:0px;padding:0px;font-family:'microsoft yahei', arial, simsun;color:rgb(84, 123, 60);text-decoration:none;outline:0px;" target="_blank">若渴若愚</a>
</span>
&gt;
<span style="list-style:none outside;margin:0px;padding:0px;font-family:'microsoft yahei', arial, simsun;vertical-align:bottom;"><a href="http://www.360doc.com/userhome.aspx?userid=7899729&amp;cid=20" style="list-style:none outside;margin:0px;padding:0px;font-family:'microsoft yahei', arial, simsun;color:rgb(46, 46, 46);text-decoration:none;outline:0px;" target="_blank">《AT指令》</a></span>
</p>
<div style="height:auto;list-style:none outside;padding:0px;font-family:'microsoft yahei', arial, simsun;width:40%;margin:0px;overflow:hidden;font-size:13px;color:rgb(112, 112, 112);float:right;text-align:right;">
<a href="https://www.baidu.com/s?wd=cnmi+class+te&amp;tn=SE_hldp01010_6r0gix1f" style="list-style:none outside;margin:0px;padding:0px;font-family:'microsoft yahei', arial, simsun;color:rgb(112, 112, 112);text-decoration:none;outline:0px;display:inline-block;height:32px;line-height:32px;" target="_blank">以文找文</a>
  |  
<a href="#" style="list-style:none outside;margin:0px;padding:0px;font-family:'microsoft yahei', arial, simsun;color:rgb(112, 112, 112);text-decoration:none;outline:0px;display:inline-block;height:32px;line-height:32px;">举报</a>
</div>
</div>
<div style="margin:0px;padding:0px;font-family:微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif;height:auto;line-height:30px;color:rgb(0, 0, 0);font-size:14px;font-weight:700;width:100%;text-align:left;">

<p style="display:block;list-style:none outside;padding:0px;font-family:'microsoft yahei', arial, simsun;margin:0px;height:26px;width:98%;overflow:hidden;word-break:keep-all;text-overflow:ellipsis;white-space:nowrap;text-align:left;"> 下一篇：<a href="http://www.360doc.com/content/12/1008/14/7899729_240227638.shtml" style="list-style:none outside;margin:0px;padding:0px;font-family:'microsoft yahei', arial, simsun;text-decoration:none;outline:0px;color:rgb(112, 112, 112);" target="_blank">PDU串发送长短信</a></p>
</div>
</div></div></div></div></div></div><br/></div></span>
</div></body></html> 