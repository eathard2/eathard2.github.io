<html>
<head>
  <title>问题详情</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="525"/>
<h1>问题详情</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/4/9 0:14</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/4/9 11:11</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://wenwen.m.sogou.com/qudetail.jsp?qid=748307890&g_f=11301026"><i>http://wenwen.m.sogou.com/qudetail.jsp?qid=748307890&amp;g_f=11301026</i></a></td></tr>
</table>
</div>
<br/>

<div>
<span><div><br/></div><div style="-evernote-webclip:true"><div style="font-size: 16px; display: inline-block;"><div style="font-style:inherit;font-variant:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;"><div style="font-variant:inherit;font-size:16px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);color:rgb(0, 0, 0);font-style:inherit;font-family:-apple-system-font, &quot;Helvetica Neue&quot;, Helvetica, STHeiTi, sans-serif;font-weight:inherit;font-stretch:inherit;vertical-align:baseline;background:rgb(255, 255, 255);"><div style="font-variant:inherit;margin:0px;font-family:inherit;border:0px;font-style:inherit;padding:0px;font-weight:inherit;font-stretch:inherit;font-size:inherit;vertical-align:baseline;margin-bottom:12px;background-color:rgb(255, 255, 255);"><div style="font-weight:inherit;vertical-align:baseline;font-family:inherit;font-style:inherit;font-variant:inherit;font-size:inherit;font-stretch:inherit;padding:10px 10px 5px;border-radius:5px;border:1px solid rgb(222, 222, 222);margin:10px 10px 0px;"><div style="border:0px;margin:0px;font-family:inherit;font-size:inherit;font-stretch:inherit;font-variant:inherit;font-style:inherit;padding:0px;vertical-align:baseline;word-break:break-all;font-weight:bold;color:rgb(40, 40, 40);margin-bottom:8px;">单片机AT命令控制GSM模块发送短信问题 <span style="color:rgb(40, 40, 40);font-weight:bold;font-style:inherit;font-variant:inherit;font-size:inherit;font-family:inherit;display:block;height:0px;clear:both;">​</span></div><div style="font-style:inherit;margin:0px;font-family:inherit;font-size:inherit;font-stretch:inherit;font-weight:inherit;border:0px;padding:0px;font-variant:inherit;vertical-align:baseline;word-wrap:break-word;margin-bottom:8px;color:rgb(102, 102, 102);"><p style="font-weight:inherit;margin:0px;border:0px;font-style:inherit;font-variant:inherit;padding:0px;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;">我在用电脑的串口调试助手用AT命令控制GSM某块发短信的时候，可以发送出去，但是，用单片机控制发送的时候，会返回+CMS ERROR：3 0d 0a 0d 0a 3 1 。连线和波特率确认没有问题，请问是什么原因？<br/><br/>
之前已经设置为PDU格式。<br/>
u8 ReplyMessage()<br/>
{<br/>
u8 TxBuffer[]=&quot;AT+CMGS=18\r\n&quot;;<br/>
int i,j;<br/>
int k=0;<br/>
int l=0;<br/>
for(i=0;i&lt;16;i++)<br/>
ReplyNo[i]=RxBuffer2[i+24];<br/>
for(j=0;j&lt;16;j++)<br/>
ReMessage[j+10]=ReplyNo[j];<br/>
while(k!=countof(TxBuffer))<br/>
{<br/>
USART_SendData(USART2, TxBuffer[k++]);<br/>
while(USART_GetFlagStatus(USART2, USART_FLAG_TXE)==RESET);<br/>
}<br/>
Delay();<br/>
while(!(StringCompare( RxBuffer,&quot;&gt;&quot;)));<br/><br/>
while(l!=countof(ReMessage))<br/>
{<br/>
/* Write one byte to the transmit data register */<br/>
USART_SendData(USART2, ReMessage[l++]);<br/>
while(USART_GetFlagStatus(USART2, USART_FLAG_TXE)==RESET){};<br/>
}<br/>
Delay();<br/>
if(StringCompare(RxBuffer,&quot;OK&quot;)) return 1;<br/>
else return 0;<br/>
}<br/>
u8 ReMessage[39]={0x30,0x30,0x33,0x31,0x30,0x30,0x31,0x30,0x41,0x31,(号码), 0x30,0x30,0x30,0x38,0x41,0x37,0x30,0x32,0x30,0x30,0x35,0x39,0x1A,0x0d,0x0a};</p></div><div style="font-style:inherit;margin:0px;font-family:inherit;font-stretch:inherit;border:0px;padding:0px;font-variant:inherit;font-weight:inherit;vertical-align:baseline;font-size:14px;">匿名网友 <span style="font-variant:inherit;vertical-align:baseline;margin:0px;padding:0px;border:0px;font-style:inherit;font-family:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;margin-right:25px;color:rgb(140, 140, 140);">2012-08-11</span> <span style="font-size:14px;font-style:inherit;font-variant:inherit;font-weight:inherit;font-family:inherit;display:block;height:0px;clear:both;">​</span></div></div></div><div style="font-variant:inherit;margin:0px;font-family:inherit;border:0px;font-style:inherit;padding:0px;font-weight:inherit;font-stretch:inherit;font-size:inherit;vertical-align:baseline;margin-bottom:12px;background-color:rgb(255, 255, 255);"><div style="font-weight:inherit;vertical-align:baseline;font-family:inherit;font-style:inherit;font-variant:inherit;padding:0px;font-stretch:inherit;font-size:inherit;border-radius:5px;border:1px solid rgb(222, 222, 222);margin:0px 10px 10px;"><div style="font-style:inherit;margin:0px;font-family:inherit;font-size:inherit;font-stretch:inherit;font-weight:inherit;border:0px;padding:0px;font-variant:inherit;vertical-align:baseline;padding-left:10px;background:-webkit-linear-gradient(top, rgb(248, 248, 248) 0px, rgb(243, 243, 243) 78%);border-bottom:1px solid rgb(218, 218, 218);border-radius:5px 5px 0px 0px;height:34px;"><h2 style="margin:0px;font-size:inherit;font-family:inherit;font-stretch:inherit;font-variant:inherit;padding:0px;border:0px;font-style:inherit;vertical-align:baseline;color:rgb(40, 40, 40);font-weight:bold;float:left;">已有答案 (2)</h2><span style="font-style:inherit;font-variant:inherit;font-weight:inherit;font-size:inherit;font-family:inherit;display:block;height:0px;clear:both;">​</span></div><div style="font-weight:inherit;margin:0px;border:0px;font-style:inherit;font-variant:inherit;padding:0px;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;"><div style="font-weight:inherit;margin:0px;font-family:inherit;border:0px;font-style:inherit;font-variant:inherit;padding:0px;font-stretch:inherit;font-size:inherit;vertical-align:baseline;border-bottom:1px solid rgb(205, 205, 205);"><div style="font-style:inherit;margin:0px;font-family:inherit;font-size:inherit;font-stretch:inherit;border:0px;font-weight:inherit;font-variant:inherit;vertical-align:baseline;word-wrap:break-word;color:rgb(40, 40, 40);padding:10px 10px 6px;">&quot;电脑的串口调试助手用AT命令控制GSM某块发短信的时候，可以发送出去&quot;说明modem解析没有问题，有条件的话看看这时候modem收到的AT命令的格式是什么样的串，然后比较你现在发送的串在modem里收到的格式和正常的是否一致，这样才会准确定位</div><div style="font-style:inherit;vertical-align:baseline;font-family:inherit;font-stretch:inherit;border:0px;padding:0px;font-variant:inherit;font-weight:inherit;font-size:14px;margin:0px 10px;">热心网友 <span style="font-variant:inherit;vertical-align:baseline;margin:0px;padding:0px;border:0px;font-style:inherit;font-family:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;margin-right:25px;color:rgb(140, 140, 140);">2012-08-12</span><ul style="font-variant:inherit;margin:0px;list-style:none;font-family:inherit;border:0px;font-style:inherit;padding:0px;font-weight:inherit;font-stretch:inherit;font-size:inherit;vertical-align:baseline;min-width:38%;float:right;"><li><a href="#" style="padding:0px;text-decoration:none;outline:0px;font-family:inherit;font-stretch:inherit;font-weight:inherit;margin:0px;font-variant:inherit;border:0px;font-style:inherit;vertical-align:baseline;color:rgb(102, 102, 102);height:26px;font-size:14px;text-align:center;display:block;">4</a> <a style="padding:0px;text-decoration:none;outline:0px;font-family:inherit;font-stretch:inherit;font-weight:inherit;font-variant:inherit;margin:0px;font-style:inherit;border:0px;vertical-align:baseline;color:rgb(102, 102, 102);height:26px;font-size:14px;text-align:center;display:block;border-right:0px none;"></a><span style="list-style:none;font-style:inherit;font-variant:inherit;font-weight:inherit;font-size:inherit;font-family:inherit;display:block;height:0px;clear:both;">​</span></li></ul><span style="font-size:14px;font-style:inherit;font-variant:inherit;font-weight:inherit;font-family:inherit;display:block;height:0px;clear:both;">​</span></div></div><div style="font-weight:inherit;margin:0px;font-family:inherit;border:0px;font-style:inherit;font-variant:inherit;padding:0px;font-stretch:inherit;font-size:inherit;vertical-align:baseline;border-bottom:0px none;"><div style="font-style:inherit;margin:0px;font-family:inherit;font-size:inherit;font-stretch:inherit;border:0px;font-weight:inherit;font-variant:inherit;vertical-align:baseline;word-wrap:break-word;color:rgb(40, 40, 40);padding:10px 10px 6px;">很明显是因为你多发了或者少发了 回车 换行符！！<br/>
0d 回车符<br/>
0a 换行符<br/>
请检查 命令格式，是否需要这两个字符？</div><div style="font-style:inherit;vertical-align:baseline;font-family:inherit;font-stretch:inherit;border:0px;padding:0px;font-variant:inherit;font-weight:inherit;font-size:14px;margin:0px 10px;"><div style="font-variant:inherit;vertical-align:baseline;font-family:inherit;border:0px;font-style:inherit;padding:0px;font-weight:inherit;font-stretch:inherit;font-size:14px;border-top:1px dotted rgb(225, 225, 225);margin:0px;"><div style="font-variant:inherit;margin:0px;color:rgb(40, 40, 40);word-wrap:break-word;border:0px;font-style:inherit;padding:5px 0px 3px;font-weight:inherit;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;padding-left:0px;"><font color="#9D9D9D">追问：</font>^z结束发送PDU字符串之后是否需要0a结束呢？我在串口调试助手如果不加0d0a的话，无法正常发送短信，加0d0a的话可以正常将短信发出去。但是在单片即上加0d0a出现上述错误，如果不加的话会出现 CMS ERROR ： 304,代码已贴出。</div></div><div style="font-variant:inherit;vertical-align:baseline;font-family:inherit;border:0px;font-style:inherit;padding:0px;font-weight:inherit;font-stretch:inherit;font-size:14px;border-top:0px none;margin:0px;"><div style="font-variant:inherit;margin:0px;color:rgb(40, 40, 40);word-wrap:break-word;border:0px;font-style:inherit;padding:5px 0px 3px;font-weight:inherit;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;padding-left:0px;"><font color="#9D9D9D">补充：</font>那肯定需要加！<br/><br/>
你看看串口调试助手发送的是十六进制，还是ascii码？<br/><br/>
串口和它的格式一样即可。</div></div><div style="font-variant:inherit;vertical-align:baseline;font-family:inherit;border:0px;font-style:inherit;padding:0px;font-weight:inherit;font-stretch:inherit;font-size:14px;border-top:0px none;margin:0px;"><div style="font-variant:inherit;margin:0px;color:rgb(40, 40, 40);word-wrap:break-word;border:0px;font-style:inherit;padding:5px 0px 3px;font-weight:inherit;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;padding-left:0px;"><font color="#9D9D9D">追问：</font>我的串口调试助手就是用16进制发送的，然后发送的内容都和上面的程序一样。</div></div><div style="font-variant:inherit;vertical-align:baseline;font-family:inherit;border:0px;font-style:inherit;padding:0px;font-weight:inherit;font-stretch:inherit;font-size:14px;border-top:0px none;margin:0px;"><div style="font-variant:inherit;margin:0px;color:rgb(40, 40, 40);word-wrap:break-word;border:0px;font-style:inherit;padding:5px 0px 3px;font-weight:inherit;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;padding-left:0px;"><font color="#9D9D9D">补充：</font>几个问题已经排除了。通讯协议肯定无问题，因为有回应。<br/><br/>
0d0a一定要加，因为计算机通讯时加了。<br/><br/>
u8 ReMessage[39]={0x30,0x30,0x33,0x31,0x30,0x30,0x31,0x30,0x41,0x31,(号码), 0x30,0x30,0x30,0x38,0x41,0x37,0x30,0x32,0x30,0x30,0x35,0x39,0x1A,0x0d,0x0a};<br/><br/>
这个格式一定没有问题吧？<br/>
00310010a1(号码)0008a7020059....0x1A是控制符。</div></div><div style="font-variant:inherit;vertical-align:baseline;font-family:inherit;border:0px;font-style:inherit;padding:0px;font-weight:inherit;font-stretch:inherit;font-size:14px;border-top:0px none;margin:0px;"><div style="font-variant:inherit;margin:0px;color:rgb(40, 40, 40);word-wrap:break-word;border:0px;font-style:inherit;padding:5px 0px 3px;font-weight:inherit;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;padding-left:0px;"><font color="#9D9D9D">追问：</font>格式应该没有问题吧。。。在电脑上面就是用的串字符串然后发送出去了，然后返回OK了</div></div><div style="font-variant:inherit;vertical-align:baseline;font-family:inherit;border:0px;font-style:inherit;padding:0px;font-weight:inherit;font-stretch:inherit;font-size:14px;border-top:0px none;margin:0px;"><div style="font-variant:inherit;margin:0px;color:rgb(40, 40, 40);word-wrap:break-word;border:0px;font-style:inherit;padding:5px 0px 3px;font-weight:inherit;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;padding-left:0px;"><font color="#9D9D9D">补充：</font>单片机通讯确实比较讨厌。<br/>
我以前都是遇到接线、或通讯协议等问题。<br/><br/>
你现在离成功只差一步之遥。</div></div>
热心网友 <span style="font-variant:inherit;vertical-align:baseline;margin:0px;padding:0px;border:0px;font-style:inherit;font-family:inherit;font-weight:inherit;font-stretch:inherit;font-size:inherit;margin-right:25px;color:rgb(140, 140, 140);">2012-08-12</span><ul style="font-variant:inherit;margin:0px;list-style:none;font-family:inherit;border:0px;font-style:inherit;padding:0px;font-weight:inherit;font-stretch:inherit;font-size:inherit;vertical-align:baseline;float:right;"><li><a href="#" style="padding:0px;text-decoration:none;outline:0px;font-family:inherit;font-stretch:inherit;font-weight:inherit;margin:0px;font-variant:inherit;border:0px;font-style:inherit;vertical-align:baseline;color:rgb(102, 102, 102);height:26px;font-size:14px;text-align:center;display:block;">5</a> <a style="padding:0px;text-decoration:none;outline:0px;font-family:inherit;font-stretch:inherit;font-weight:inherit;font-variant:inherit;margin:0px;font-style:inherit;border:0px;vertical-align:baseline;color:rgb(102, 102, 102);height:26px;font-size:14px;text-align:center;display:block;border-right:0px none;"></a><span style="list-style:none;font-style:inherit;font-variant:inherit;font-weight:inherit;font-size:inherit;font-family:inherit;display:block;height:0px;clear:both;">​</span></li></ul><ul style="font-weight:inherit;margin:0px;list-style:none;opacity:1;transform-origin:0px 0px 0px;border:0px;font-style:inherit;font-variant:inherit;padding:0px;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;margin-top:10px;border-top:1px solid rgb(204, 204, 204);transform:scale(1, 1);"><li> <span style="list-style:none;font-style:inherit;font-variant:inherit;font-weight:inherit;font-size:inherit;font-family:inherit;display:block;height:0px;clear:both;">​</span></li></ul><span style="font-size:14px;font-style:inherit;font-variant:inherit;font-weight:inherit;font-family:inherit;display:block;height:0px;clear:both;">​</span></div></div></div></div></div><div style="font-variant:inherit;margin:0px;font-family:inherit;border:0px;font-style:inherit;padding:0px;font-weight:inherit;font-stretch:inherit;font-size:inherit;vertical-align:baseline;margin-bottom:12px;background-color:rgb(255, 255, 255);"><div style="font-weight:inherit;vertical-align:baseline;font-family:inherit;font-style:inherit;font-variant:inherit;padding:0px;font-stretch:inherit;font-size:inherit;border-radius:5px;border:1px solid rgb(222, 222, 222);margin:0px 10px 10px;"><div style="font-style:inherit;margin:0px;font-family:inherit;font-size:inherit;font-stretch:inherit;font-weight:inherit;border:0px;padding:0px;font-variant:inherit;vertical-align:baseline;padding-left:10px;background:-webkit-linear-gradient(top, rgb(248, 248, 248) 0px, rgb(243, 243, 243) 78%);border-bottom:1px solid rgb(218, 218, 218);border-radius:5px 5px 0px 0px;height:34px;"><h2 style="margin:0px;font-size:inherit;font-family:inherit;font-stretch:inherit;font-variant:inherit;padding:0px;border:0px;font-style:inherit;vertical-align:baseline;color:rgb(40, 40, 40);font-weight:bold;float:left;">相关问题</h2><span style="font-style:inherit;font-variant:inherit;font-weight:inherit;font-size:inherit;font-family:inherit;display:block;height:0px;clear:both;">​</span></div><ul style="font-weight:inherit;vertical-align:baseline;list-style:none;border:0px;font-style:inherit;font-variant:inherit;padding:0px;font-stretch:inherit;font-size:inherit;font-family:inherit;margin:10px;"><li style="font-style:inherit;margin:0px;font-family:inherit;font-stretch:inherit;font-weight:inherit;border:0px;padding:0px;font-variant:inherit;vertical-align:baseline;font-size:14px;margin-bottom:5px;"><a href="#" style="font-variant:inherit;text-decoration:none;outline:0px;margin:0px;padding:0px;border:0px;font-style:inherit;color:rgb(0, 0, 0);font-weight:inherit;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;">怎样用51单片机控制GSM模块发短信,求相关程序C语言就行谢谢</a></li><li style="font-style:inherit;margin:0px;font-family:inherit;font-stretch:inherit;font-weight:inherit;border:0px;padding:0px;font-variant:inherit;vertical-align:baseline;font-size:14px;margin-bottom:5px;"><a href="#" style="font-variant:inherit;text-decoration:none;outline:0px;margin:0px;padding:0px;border:0px;font-style:inherit;color:rgb(0, 0, 0);font-weight:inherit;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;">单片机控制TC35GSM模块发送简单短信的问题。</a></li><li style="font-style:inherit;margin:0px;font-family:inherit;font-stretch:inherit;font-weight:inherit;border:0px;padding:0px;font-variant:inherit;vertical-align:baseline;font-size:14px;margin-bottom:5px;"><a href="#" style="font-variant:inherit;text-decoration:none;outline:0px;margin:0px;padding:0px;border:0px;font-style:inherit;color:rgb(0, 0, 0);font-weight:inherit;font-stretch:inherit;font-size:inherit;font-family:inherit;vertical-align:baseline;">单片机控制GSM发送短信部分程序问题。</a></li></ul></div></div><img src="问题详情_files/irt.gif" type="image/gif" height="1" style="font-weight: inherit; border: 0px; padding: 0px; font-style: inherit; font-variant: inherit; margin: 0px; font-stretch: inherit; font-size: inherit; font-family: inherit; vertical-align: baseline; height: auto;" width="1"/></div></div></div><br/></div></span>
</div></body></html> 