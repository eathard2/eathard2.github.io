<html>
<head>
  <title>【新提醒】分享GSM(SIM800)模块的使用 - STM32/STM8技术论坛 - 中国电子技术论坛 - 最好最受欢迎电子论坛!</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="318"/>
<h1>【新提醒】分享GSM(SIM800)模块的使用 - STM32/STM8技术论坛 - 中国电子技术论坛 - 最好最受欢迎电子论坛!</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/4/7 14:56</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://bbs.elecfans.com/jishu_1100470_1_1.html"><i>http://bbs.elecfans.com/jishu_1100470_1_1.html</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div><div><div><div><h1> [经验] 分享GSM(SIM800)模块的使用 </h1><div><div></div></div></div>
        








	




    
                
                        
        
 


<div>      此GSM模块采用SIMCOM 公司的工业级四频 850/900/1800/1900MHz  SIM800 <a href="http://www.hqchip.com/?u=999" target="_blank">芯片</a>, 可以低功耗实现语音、SMS、数据和传真信息的传输。 可以运用到短信监控二氧化氮、短信监控烟雾报警器、无线终端（短信猫）、 工业监测与控制（温湿度、二氧化碳） 、远程抄表系统 、 智能家居控制系统等控制平台。</div><strong>1.1  接线图：</strong><div>
<span>

<div><img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/Image.jpg" type="image/jpeg" height="318" width="576"/></div>



</span>
</div><table><tbody><tr><td><div>引脚名称</div></td><td><div><div>功能</div></div></td></tr><tr><td><div><div>T_RX</div></div></td><td><div><div>连接<a href="http://bbs.elecfans.com/zhuti_mcu_1.html" target="_blank">单片机</a>的UART_RX</div></div></td></tr><tr><td><div><div>T_TX</div></div></td><td><div><div>连接单片机的UART_TX</div></div></td></tr><tr><td><div><div>GND</div></div></td><td><div><div>连接单片机的GND</div></div></td></tr><tr><td><div><div>V_MCU</div></div></td><td><div><div>连接单片机板子的电压 5v 或者 3.3v，会让 T-RX 和 T-TX 引脚电平逻辑和 V_MCU 一致若接的 5v，则 T-RX 和 T-TX 引脚逻辑电平为 5v；若接的 3.3v，则 T-RX 和 T-TX 引脚逻辑电平为 3.3v；</div><div>该引脚是单片机板子的电压引脚对 GSM 模块的 TTL 逻辑电平的调整，并不能作为 GSM 模块的供电来使用。</div></div></td></tr></tbody></table><div>
<span>

<div><img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/Image [1].jpg" type="image/jpeg" height="432" width="576"/></div>



</span>
</div><div>       <a href="http://bbs.elecfans.com/try.html" target="_blank">开发板</a>和GSM模块需要4根线来连接，按照我们前面提供的接线图连好即可。我们还需要一张移动或联通的SIM卡(不支持电信卡)，如果你的是micro SIM卡，也没有卡套，是不是不能用了？</div><div>        当然不是，只要我们把micro SIM卡的金属接触点和模块上的SIM卡槽的接触点对好就行。</div><div>        线和SIM卡都接好后，我们需要给开发板和GSM模块供电。要注意的是，开发板是5V的<a href="http://bbs.elecfans.com/zhuti_power_1.html" target="_blank">电源</a>，而GSM模块是9V的电源，使用是要特别留意两者的接头，不要搞混了，因为如果开发板接了9V的电源的话，会烧坏开发板。</div><div>我们目前提供了4个演示程序，分别是：F429_GSM_短信收发、F429_GSM_通话、F429_GSM_中文短信收发、F429_GSM_GPRS ；因和GSM模块<a href="http://bbs.elecfans.com/zhuti_wireless_1.html" target="_blank">通信</a>都是发AT指令，代码没有什么难理解的地方，所以这里我就简单介绍下这几个例程实现的功能及要注意的地方。</div><div>        GSM模块和红龙429是通过UART6通信，为了方便我们前期调试的时候看到GSM返回的信息，我们用了USART1来转发UART6接收到的数据。</div><strong>1.2  启动GSM模块</strong><div>        给GSM模块接上9V1A的电源后，按下模块上的开关，电源接口旁边的指示灯亮起，说明通电正常，然后需要按下GSM模块上的PWR_KEY按键1秒以上。</div><div>         烧写（F429_GSM_短信收发）程序到开发板，用micro-USB线连接板子J3的USB口，打开串口调试助手。</div><div>
<span>

<div><img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/Image [2].jpg" type="image/jpeg" height="433" width="546"/></div>



</span>
</div><div>      如果串口打印显示发AT指令返回OK，并能读取信号强度和当前运营商，说明GSM模块和我们的开发板之间的通信是没问题了。若串口打印出---SIM800无响应，请检查后重新启动，可以通过以下几种方式来排除问题。</div><div>1）检查GSM模块上串口旁边的两个跳线位置，下图的连接才是正确的。</div><div>
<span>

<div><img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/Image [3].jpg" type="image/jpeg" height="172" width="353"/></div>



</span>
</div><div>2）观察LED灯闪的状态</div><table><tbody><tr><td><div>LED灯闪状态</div></td><td><div><div>SIM800工作状态</div></div></td></tr><tr><td><div><div>熄灭</div></div></td><td><div><div>SIM800没有工作</div></div></td></tr><tr><td><div><div> 60ms 亮/800ms   熄灭</div></div></td><td><div><div>SIM800 没有找到服务（GSM 卡无服务）</div></div></td></tr><tr><td><div><div>60ms 亮/3000ms 熄灭 </div></div></td><td><div><div>SIM800 连接到服务信号</div></div></td></tr><tr><td><div><div> 60ms 亮/300ms   熄灭</div></div></td><td><div><div>SIM800 正在 GPRS 通讯</div></div></td></tr></tbody></table><div>      3）检查下这个SIM卡和我们模块的金属接触点，如果是micro SIM卡的用户，可以找个卡套，排除接触不良的情况；</div><div>问题都排除后，并能打印出正常的开机信息，就可以收发短信了。</div><strong>1.3  收发英文短信</strong><div>     用其他<a href="http://bbs.elecfans.com/zhuti_tel_1.html" target="_blank">手机</a>给我们模块上的号码发送一条纯英文的短信，模块收到后，板子上的蜂鸣器会鸣叫一声，表示收到了新短信，这时，我们可以按下开发板的S3按键，来读取上一次收到的新消息。</div><div>
<span>

<div><img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/Image [4].jpg" type="image/jpeg" height="433" width="546"/></div>



</span>
</div><div>      实验前注意，程序里填写的是我们测试的号码，你在使用的时候，需要号码改成自己的，编译后再烧写到开发板验证。</div><div>     代码位于工程中的SIM_800.c</div><div>1. /**</div><div>2.   * @brief  发送短信</div><div>3.   * @param  None</div><div>4.   * @retval   None</div><div>5.   */</div><div>6. void SIM800_SendSMS(void)</div><div>7. {                                                                                                   //短信发送测试        </div><div>8.                                         //CSM字符集和文本模式 在前面设置过,无需重复设置</div><div>9.         char *sendSMS=&quot;welcome to xxx.openmcu.xxx&quot;;</div><div>10.         if(SIM800_Cmd(&quot;AT+CMGS=\&quot;13534298280\&quot;&quot;,&quot;&gt;&quot;,NULL,500)!=0)   </div><div>11.                                                                             //注意,改成收信人的号码,可以自己发给自己</div><div>12.          {</div><div>13.                                                               //返回&gt;时就可以输入要发送的内容</div><div>14.              USART6_Send_Data((u8*)sendSMS,strlen(sendSMS));                                                    </div><div>15.       printf(&quot;\r\n启动发送\r\n&quot;);                                                         </div><div>16.              USART_SendData(USART6,STARTSEND);                          //启动发送</div><div>17.              printf(&quot;\r\n发送完成\r\n&quot;);</div><div>18.          }</div><div>19. }</div><div>      如果找不到其他手机来测试，可以把上面函数SIM800_SendSMS 中的SIM800_Cmd(&quot;AT+CMGS=\&quot;xxxxxxxxxxx\&quot;&quot;,&quot;&gt;&quot;,NULL,500)，改成自己的手机号码，实现自发自收。</div><strong>1.4  收发中英混合短信</strong><div>     中文短信，因为中文短信都是采用Unicode编码，为了能在串口调试助手中直观的看到短信内容，我们在程序里放置了Unicode to  BGK转换表（约占27KB的ROM空间），大概有6000多个常用汉字。</div><div>
<span>

<div><img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/Image [5].jpg" type="image/jpeg" height="433" width="546"/></div>



</span>
</div><div>
<span>

<div><img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/Image [6].jpg" type="image/jpeg" height="433" width="546"/></div>



</span>
</div><div>
<span>

<div><img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/Image [7].jpg" type="image/jpeg" height="433" width="546"/></div>



</span>
</div><div>      从上图可以看到，SIM800直接返回的是Unicode码，无法直接阅读短信内容，在经过程序处理后，就可以显示中文的短信内容了。程序目前实现的是Unicode to BGK ，没有实现BGK to Unicode，所以，要发送中文短信，需把要发送的短信内容和收件方的手机号码通过软件转换成Unicode。</div><div>1. /**</div><div>2.   * @brief  发送中文短信</div><div>3.   * @param  None</div><div>4.   * @retval   None</div><div>5.   */</div><div>6. void SIM800_SendSMS_CN(void)</div><div>7. {                                                                         //短信发送测试  全部按Unicode编码        </div><div>8.                                                                        //文本模式在前面设置过,无需重复设置</div><div>9. </div><div>10. </div><div>11. </div><div>12. </div><div>13. char*sendSMS=&quot;0063006F006D0065002000660072006F006D00206DF1573365FA5B9D75355B50&quot;;                                                             //come from 深圳旺宝<a href="http://bbs.elecfans.com/" target="_blank">电子</a>                  </div><div>14. Char*phoneNum=&quot;AT+CMGS=\&quot;00310033003500330034003200390038003200380030\&quot;&quot;;                                                                      //使用时替换成自己的号码</div><div>15.         if(SIM800_Cmd(phoneNum,&quot;&gt;&quot;,NULL,500)!=0)           //注意,改成收信人的号码,可以自 己发给自己做测试</div><div>16.          {</div><div>17.                                                                            //返回&gt;时就可以输入要发送的内容</div><div>18.        USART6_Send_Data((u8*)sendSMS,strlen(sendSMS));                                                    </div><div>19.        printf(&quot;\r\n启动发送\r\n&quot;);                                                         </div><div>20.               USART_SendData(USART6,STARTSEND);                          //启动发送</div><div>21.               printf(&quot;\r\n发送完成\r\n&quot;);</div><div>22.          }</div><div>23. }</div><div>
<span>

<div><img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/Image [8].jpg" type="image/jpeg" height="255" width="427"/></div>



</span>
</div><div>Copy到代码里时要手动去掉空格。</div><strong>1.5  语音通话</strong><div>1．int main(void)</div><div>2．{  </div><div>3．//        LED_Init();</div><div>4．        Key_Init();</div><div>5．        BEEP_Init();</div><div>6．        USART1_Init();</div><div>7．        USART6_Init();</div><div>8．        printf(&quot;\r\n&quot;);</div><div>9．        printf(&quot;Hello Welcome.\r\n&quot;);</div><div>10．        printf(&quot;Thank You For Choosing Our Products.\r\n&quot;);</div><div>11．        printf(&quot;Thank You Very Much.\r\n&quot;);</div><div>12．        printf(&quot;This Example GSM module call test.\r\n&quot;);</div><div>13．        printf(&quot;\r\n&quot;);</div><div>14．        printf(&quot;SIM800 Ini<a href="http://bbs.elecfans.com/zhuti_715_1.html" target="_blank">ti</a>alization...\r\n&quot;);                    </div><div>15． printf(&quot;Ok,Let's Go...\r\n&quot;);        </div><div>16．        </div><div>17． SIM800_Init();</div><div>18．        printf(&quot;\r\n按S2接听电话,按S3拨打电话\r\n&quot;);     </div><div>19．  while (1)</div><div>20．        { </div><div>21．            if(findstring((char*)rx_bufferu6, &quot;RING&quot;,4))//检查是否有来电标志</div><div>22．             {</div><div>23．                BEEP_Toggle(2,300);                                 //提示</div><div>24．              }</div><div>25．                        </div><div>26．                 </div><div>27．             if(data_length)</div><div>28．              {</div><div>29．          delay_ms(10);                </div><div>30．          switch(rx_buffer[0])</div><div>31．           {</div><div>32．                               case  '1':SIM800_Cmd(&quot;ATA&quot;,&quot;OK&quot;,NULL,500);             //接听</div><div>33．                             memset(rx_bufferu6,0x00,DATA_BUF_SIZE);</div><div>34．                             break;</div><div>35．                                case '2':SIM800_EndCall();                                            //挂断</div><div>36．                             break;</div><div>37．                          }                                </div><div>38．                       data_length = 0;</div><div>39．              }                        </div><div>40．              if(data_lengthu6)</div><div>41．                {</div><div>42．                           delay_ms(10);                                                </div><div>43．                           USART1_Send_Data(rx_bufferu6,data_lengthu6);        </div><div>44．                           data_lengthu6 = 0;        </div><div>45．                }</div><div>46．              if(GPIO_ReadInputDataBit(GPIOD, GPIO_Pin_11))      //S3按下,拨打电话</div><div>47．               { </div><div>48．                          delay_ms(20);</div><div>49．           if(!(GPIO_ReadInputDataBit(GPIOD, GPIO_Pin_11))) </div><div>50．              {</div><div>51．                        SIM800_Call(&quot;10086;&quot;);               //拨打电话,注意,号码后面要加分号               </div><div>52．               }                                                                                </div><div>53．           }                                                          </div><div>54．            if(GPIO_ReadInputDataBit(GPIOA, GPIO_Pin_0))        //S2按下,接听电话</div><div>55．             {</div><div>56．                 delay_ms(20);                                           </div><div>57．                 if(!(GPIO_ReadInputDataBit(GPIOA, GPIO_Pin_0)))   //按键松开?</div><div>58．             {                </div><div>59．                                SIM800_Answer();                                                 //接听电话                                                                   </div><div>60．              }</div><div>61．              }</div><div>62．    }</div><div>63．}</div><div>     模块上有两个接口，要测试语音通话功能，需要 将耳机插到如下图的位置。</div><div>
<span>

<div><img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/Image [9].jpg" type="image/jpeg" height="157" width="331"/></div>



</span>
</div><div>      从前面的代码可以看到，当GSM启动信息正常后，如果你要接听来电，可以按下开发板S2，用其他手机给SIM卡上的号码拨号，开发板的蜂鸣器会鸣叫一声，表示有新来电，然后可以在串口调试助手中输入1来接听电话，输入2挂断电话。如果是拨打电话，按下开发板的S3， 程序默认拨打的是10086，SIM800_Call(&quot;10086;&quot;);     可以改成你要拨打的号码，注意号码后面的分号不要漏了。</div><div>
<span>

<img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/rar.gif" type="image/gif" height="32" width="32"/>


<a href="http://bbs.elecfans.com/forum.php?mod=attachment&amp;aid=NDIyODc0fDRhNTNlY2UzfDE0OTE1NDgxMjN8MTQxMTQzMHwxMTAwNDcw" target="_blank">【32】红龙429_GSM_短信收发(2016.04.09).rar</a>

<em>(107.85 KB, 下载次数: 27)</em>



</span>
</div><div>
<span>

<img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/rar [1].gif" type="image/gif" height="32" width="32"/>


<a href="http://bbs.elecfans.com/forum.php?mod=attachment&amp;aid=NDIyODc1fGUxN2ZkOTE0fDE0OTE1NDgxMjN8MTQxMTQzMHwxMTAwNDcw" target="_blank">【33】红龙429_GSM_中文短信收发(2016.04.09).rar</a>

<em>(219.26 KB, 下载次数: 12)</em>



</span>
</div><div>
<span>

<img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/rar [2].gif" type="image/gif" height="32" width="32"/>


<a href="http://bbs.elecfans.com/forum.php?mod=attachment&amp;aid=NDIyODc2fGUzODFhZjRifDE0OTE1NDgxMjN8MTQxMTQzMHwxMTAwNDcw" target="_blank">【34】红龙429_GSM_通话(2016.04.09).rar</a>

<em>(69.22 KB, 下载次数: 12)</em>



</span>
</div><div>
<span>

<img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/rar [3].gif" type="image/gif" height="32" width="32"/>


<a href="http://bbs.elecfans.com/forum.php?mod=attachment&amp;aid=NDIyODczfGE3NTRlZDc3fDE0OTE1NDgxMjN8MTQxMTQzMHwxMTAwNDcw" target="_blank">【35】红龙429_GSM_GPRS(2016.04.09).rar</a>

<em>(270.5 KB, 下载次数: 53)</em>



</span>
</div>
</div></div><div><div></div><div><em>第 2 页</em></div></div><div><div>
            

<table>
<tbody><tr>
<td rowspan="2">
<div>
 



     <p>实习生</p>
 

<div><table><tbody><tr><th><p><a href="http://bbs.elecfans.com/home.php?mod=space&amp;uid=2383301&amp;do=thread&amp;type=thread&amp;view=me&amp;from=space" target="_blank">0</a></p>主题</th><th><p><a href="http://bbs.elecfans.com/home.php?mod=space&amp;uid=2383301&amp;do=thread&amp;type=reply&amp;view=me&amp;from=space" target="_blank">39</a></p>帖子</th><td><p><a href="http://bbs.elecfans.com/home.php?mod=space&amp;uid=2383301&amp;do=profile" target="_blank">2</a></p>积分</td></tr></tbody></table></div>


<dl>
	<dt>经验</dt>
</dl>







</div>


</td>
	
<td>



            <div>
        <div>

<div>
<em>发表于 2017-1-15 14:05:03　　</em>
					

    </div>
                    
                </div>
</div>
        <div><div>
<div>
<table><tbody><tr><td>
<div><a href="https://www.hqpcb.com/30" target="_blank"><div><img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/31-1F4061613350-L.jpg" type="image/jpeg" alt="华强PCB打样" height="250" width="300"/></div></a></div>4</td></tr></tbody></table>


</div>



</div>
</div>

</td></tr>





<tr>
<td>
</td>
    <td>
        <img src="【新提醒】分享GSM(SIM800)模块的使用 - STM32STM8技术论坛 - 中国电_files/Image.png" type="image/png" height="8" width="18"/>
</td>
</tr>
</tbody></table>
        </div></div></div><br/></div></span>
</div></body></html> 