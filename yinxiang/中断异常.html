<html>
<head>
  <title>中断/异常</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="813"/>
<h1>中断/异常</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/4/20 14:11</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://www.jianshu.com/p/fcc02482684c"><i>http://www.jianshu.com/p/fcc02482684c</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="box-sizing:border-box;font-family:sans-serif;text-size-adjust:100%;font-size:10px;-webkit-tap-highlight-color:transparent;"><div style="box-sizing:border-box;font-size:17px;line-height:1.42857;color:rgb(51, 51, 51);background-color:rgb(255, 255, 255);min-width:768px;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;margin:0px auto;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;color:rgb(47, 47, 47);word-break:break-word;font-size:16px;font-weight:400;line-height:1.7;">
          <p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">中断/异常，是操作系统的驱动力，就好比汽车的发动机、飞机的引擎</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><h4 style="box-sizing:border-box;font-family:inherit;font-weight:700;line-height:1.7;color:rgb(47, 47, 47);font-size:20px;margin:0px 0px 15px;text-rendering:optimizeLegibility;"><i style="box-sizing:border-box;"><b style="box-sizing:border-box;font-weight:700;">是什么？</b></i></h4><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">中断是CPU对系统发生的<b style="box-sizing:border-box;font-weight:700;">某个事件</b>作出的一种反应</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">当中断发生时，CPU暂停正在执行的程序，<b style="box-sizing:border-box;font-weight:700;">保留现场</b>后<b style="box-sizing:border-box;font-weight:700;">自动转去</b><i style="box-sizing:border-box;">执行相应事件的处理程序</i>，处理完成后返回断点，<b style="box-sizing:border-box;font-weight:700;">继续执行</b>被打断的程序<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><h4 style="box-sizing:border-box;font-family:inherit;font-weight:700;line-height:1.7;color:rgb(47, 47, 47);font-size:20px;margin:0px 0px 15px;text-rendering:optimizeLegibility;"><i style="box-sizing:border-box;">为什么？</i></h4><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">中断的引入，<i style="box-sizing:border-box;"><b style="box-sizing:border-box;font-weight:700;">为了支持CPU和设备之间的并行操作</b></i><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">当CPU启动设备进行输入/输出后，设备便可以独立工作，CPU转去处理与此次输入/输出不相关的事情；当设备完成输入/输出后，通过向CPU<b style="box-sizing:border-box;font-weight:700;">发中断报告</b>此次输入/输出的结果，让CPU决定如何处理以后的事情（及时处理设备发来的中断请求）<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">异常的引入，<i style="box-sizing:border-box;"><b style="box-sizing:border-box;font-weight:700;">表示CPU执行指令时本身出现的问题</b></i> （“问题”为广泛含义）<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">如算术溢出、除零、取数时的奇偶错，访存地址时越界或<b style="box-sizing:border-box;font-weight:700;">执行了“陷入指令”</b>等，这时<b style="box-sizing:border-box;font-weight:700;">硬件改变了CPU当前的执行流程</b>，转到相应的错误处理程序或异常处理程序或<b style="box-sizing:border-box;font-weight:700;">执行系统调用</b>（可使OS捕获用户程序提出的服务请求，也可防止用户程序执行过程中的破坏性活动）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><i style="box-sizing:border-box;"><b style="box-sizing:border-box;font-weight:700;">Summary</b></i></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><b style="box-sizing:border-box;font-weight:700;">&gt;&gt; 中断（外中断）</b>：外部事件，正在运行的程序不期望的（在CPU之外，打断了CPU）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">a. <b style="box-sizing:border-box;font-weight:700;">I/O中断</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 在键盘上按下Ctrl + C<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 网络上来了一个包，网卡接收到一个新的数据包</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 打印机打印结束了</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 读盘结束了<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">b. <b style="box-sizing:border-box;font-weight:700;">时钟中断</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 设定的定时器到了</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- CPU运行的程序时间片到了<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">c. <b style="box-sizing:border-box;font-weight:700;">硬件故障</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 笔记本电池快没电了，报警<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><b style="box-sizing:border-box;font-weight:700;">&gt;&gt; 异常（内中断）</b>：由正在执行的指令引发<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">a. <b style="box-sizing:border-box;font-weight:700;">系统调用</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">b. <b style="box-sizing:border-box;font-weight:700;">页故障/页错误</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 缺页异常<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">c. <b style="box-sizing:border-box;font-weight:700;">保护性异常</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 一块内存空间标记成只读，当要做一个写操作，（操作和权限）就冲突了<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">d. <b style="box-sizing:border-box;font-weight:700;">断点指令</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 访问一个内存空间，访问的区域地址越界了<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">e. <b style="box-sizing:border-box;font-weight:700;">其它程序性异常</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 算术溢出</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 读内存的时候，奇偶校验错<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><h4 style="box-sizing:border-box;font-family:inherit;font-weight:700;line-height:1.7;color:rgb(47, 47, 47);font-size:20px;margin:0px 0px 15px;text-rendering:optimizeLegibility;">
<i style="box-sizing:border-box;">怎么办？</i><br style="box-sizing:border-box;"/>
</h4><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">从两个角度来剖析中断/异常机制工作原理：</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">1. 硬件做什么？  -- <b style="box-sizing:border-box;font-weight:700;">中断响应</b><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    <b style="box-sizing:border-box;font-weight:700;">捕获</b>中断源发出的中断/异常<b style="box-sizing:border-box;font-weight:700;">请求</b>，以一定方式<b style="box-sizing:border-box;font-weight:700;">响应</b>，将处理器控制权<b style="box-sizing:border-box;font-weight:700;">交给</b>特定的处理程序（这个过程由中断硬件部件完成）<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">2. 软件怎么做？  -- <b style="box-sizing:border-box;font-weight:700;">中断处理程序</b><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    <b style="box-sizing:border-box;font-weight:700;">识别</b>中断/异常<b style="box-sizing:border-box;font-weight:700;">类型</b>并<b style="box-sizing:border-box;font-weight:700;">完成</b>相应的<b style="box-sizing:border-box;font-weight:700;">处理</b><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><i style="box-sizing:border-box;"><b style="box-sizing:border-box;font-weight:700;">重点：区分哪些是软件（操作系统）事先做好的工作，哪些是硬件在执行过程中要做的规定的流程</b></i><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><b style="box-sizing:border-box;font-weight:700;">一、设计操作系统时，为每一类中断/异常事件编好相应的处理程序</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><b style="box-sizing:border-box;font-weight:700;">二、在操作系统初始化的过程中，把中断向量表设置好（PC、PSW）</b><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><b style="box-sizing:border-box;font-weight:700;">三、CPU何时响应中断？（硬件）</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">1. 在CPU每条指令执行周期的最后时刻扫描<b style="box-sizing:border-box;font-weight:700;">中断寄存器</b>（CPU控制部件中设有中断寄存器），查看<i style="box-sizing:border-box;"><b style="box-sizing:border-box;font-weight:700;">是否有中断信号</b></i>？</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">2. CPU处理完当前指令后<i style="box-sizing:border-box;"><b style="box-sizing:border-box;font-weight:700;">检测到中断</b></i>（允许中断），<span style="box-sizing:border-box;">判断出中断来源并向相关设备发确认信号。中断硬件将该中断触发器内容按规定编码送入PSW的相应位，称为</span><b style="box-sizing:border-box;font-weight:700;"><span style="box-sizing:border-box;">中断码</span></b><span style="box-sizing:border-box;">。</span>处理器状态被切换到<b style="box-sizing:border-box;font-weight:700;">内核态</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">3. 中断硬件部件<b style="box-sizing:border-box;font-weight:700;">保存现场</b>，保存内容（<span style="box-sizing:border-box;">PSW</span>、PC）到<b style="box-sizing:border-box;font-weight:700;">系统堆栈</b>里面（保存被中断程序的重要上下文环境）（#关键寄存器的信息）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">4. 中断硬件根据中断码查中断向量表，得到对应的<b style="box-sizing:border-box;font-weight:700;">中断处理程序</b>（具体步骤见<i style="box-sizing:border-box;"> X86 处理器对中断/异常的支持</i>）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">5. 把中断处理程序的<b style="box-sizing:border-box;font-weight:700;">入口地址</b>等相关信息推送到相应的寄存器（PC）<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">6. 下一个指令周期开始，<b style="box-sizing:border-box;font-weight:700;">执行中断处理程序</b><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">7. 若<b style="box-sizing:border-box;font-weight:700;"><i style="box-sizing:border-box;">无中断信号</i></b>（或禁止中断），继续执行下一条指令<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">a. <i style="box-sizing:border-box;"><b style="box-sizing:border-box;font-weight:700;">中断向量表</b></i>（软硬件结合的数据结构）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">中断向量：一个内存单元，存放<b style="box-sizing:border-box;font-weight:700;">中断处理程序入口地址</b>和程序运行时所需的<b style="box-sizing:border-box;font-weight:700;">处理机状态字</b></p><div style="box-sizing:border-box;padding-bottom:25px;width:700px;margin-left:-40px;text-align:center;">
<img src="中断异常_files/100.png" type="image/png" height="183" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:100%;height:auto;cursor:-webkit-zoom-in;transition:all 0.25s ease-in-out;" width="468"/><br style="box-sizing:border-box;"/><div style="padding:10px;box-sizing:border-box;max-width:80%;min-height:22px;display:inline-block;min-width:20%;margin:0px auto;border-bottom:1px solid rgb(217, 217, 217);font-size:14px;color:rgb(150, 150, 150);line-height:1.7;">中断向量表</div>
</div><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">b. <i style="box-sizing:border-box;"><b style="box-sizing:border-box;font-weight:700;">Linux中的中断向量表</b></i><br style="box-sizing:border-box;"/></p><div style="box-sizing:border-box;padding-bottom:25px;width:700px;margin-left:-40px;text-align:center;">
<img src="中断异常_files/100 [1].png" type="image/png" height="413" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:100%;height:auto;cursor:-webkit-zoom-in;transition:all 0.25s ease-in-out;" width="628"/><br style="box-sizing:border-box;"/><div style="padding:10px;box-sizing:border-box;max-width:80%;min-height:22px;display:inline-block;min-width:20%;margin:0px auto;border-bottom:1px solid rgb(217, 217, 217);font-size:14px;color:rgb(150, 150, 150);line-height:1.7;">Linux中的中断向量表</div>
</div><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><b style="box-sizing:border-box;font-weight:700;">四、执行中断处理程序（软件）</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">1. 保存相关寄存器信息（现场信息）到系统堆栈（#其它寄存器的信息）<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">2. 分析中断/异常的具体原因（哪一类中断/异常，比如打印机，是正常打印结束还是缺纸还是缺墨）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">3. 根据具体原因执行对应的处理功能（比较具体的工作）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">4. 恢复现场，返回被事件打断的程序</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><b style="box-sizing:border-box;font-weight:700;">五、中断处理结束（硬件）</b><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">中断处理结束时，CPU检测到中断返回指令，从系统堆栈中恢复被中断程序的上下文环境，CPU状态恢复成原来的状态，PSW和PC恢复成中断前的值，CPU开始一个新的指令周期<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><i style="box-sizing:border-box;"><b style="box-sizing:border-box;font-weight:700;">Summary</b></i><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">软件提前设置好，硬件部件来执行</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><h4 style="box-sizing:border-box;font-family:inherit;font-weight:700;line-height:1.7;color:rgb(47, 47, 47);font-size:20px;margin:0px 0px 15px;text-rendering:optimizeLegibility;">
<i style="box-sizing:border-box;">X86 处理器对中断/异常的支持</i><br style="box-sizing:border-box;"/>
</h4><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">两个概念：</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">1. 中断向量表（Interrupt Vector）（实模式）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">2. 中断描述符表（Interrupt Descriptor Table）（保护模式）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    采用门（gate）描述数据结构表示中断向量</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">四种类型门描述符：</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">a. 任务门（Task Gate）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">b. <b style="box-sizing:border-box;font-weight:700;">中断门</b>（Interrupt Gate）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 给出<b style="box-sizing:border-box;font-weight:700;">段选择符</b>（Segment Selector）、中断/异常程序的<b style="box-sizing:border-box;font-weight:700;">段内偏移量</b>（Offset）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 通过中断门后系统会<b style="box-sizing:border-box;font-weight:700;">自动禁止中断</b><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">c. <b style="box-sizing:border-box;font-weight:700;">陷阱门</b>（Trap Gate）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">    -- 与中断门类似，但通过陷阱门后系统<b style="box-sizing:border-box;font-weight:700;">不会自动禁止中断</b><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">d. 调用门（Call Gate）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><div style="box-sizing:border-box;padding-bottom:25px;width:700px;margin-left:-40px;text-align:center;">
<img src="中断异常_files/100 [2].png" type="image/png" height="394" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:100%;height:auto;cursor:-webkit-zoom-in;transition:all 0.25s ease-in-out;" width="700"/><br style="box-sizing:border-box;"/><div style="padding:10px;box-sizing:border-box;max-width:80%;min-height:22px;display:inline-block;min-width:20%;margin:0px auto;border-bottom:1px solid rgb(217, 217, 217);font-size:14px;color:rgb(150, 150, 150);line-height:1.7;">X86处理器对中断的支持</div>
</div><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">通过<b style="box-sizing:border-box;font-weight:700;">IDTR寄存器</b>可以得到<b style="box-sizing:border-box;font-weight:700;">中断描述符表</b>的地址，中断描述符表的每一行叫做<b style="box-sizing:border-box;font-weight:700;">中断描述符</b>或门描述符</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">中断描述符是64位，里面有门类型（是中断门还是陷阱门）、特权级DPL，通过中断描述符，得到了一个<b style="box-sizing:border-box;font-weight:700;">段选择符</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">段选择符其实就是一个<b style="box-sizing:border-box;font-weight:700;">索引</b>（在GDT表中的索引还是在LDT表中的索引），它也有特权级</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">中断处理程序的相关信息放在全局描述符表，通过用段选择符在<b style="box-sizing:border-box;font-weight:700;">全局描述符表</b>中查找得到<b style="box-sizing:border-box;font-weight:700;">段描述符</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">段描述符中也有相应的权限（属性），主要关注的是<b style="box-sizing:border-box;font-weight:700;">段的基地址</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">有了段的基地址，有了在中断描述符当中的<b style="box-sizing:border-box;font-weight:700;">偏移量</b>，就得到<b style="box-sizing:border-box;font-weight:700;">中断服务程序的入口地址</b><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><div style="box-sizing:border-box;padding-bottom:25px;width:700px;margin-left:-40px;text-align:center;">
<img src="中断异常_files/100 [3].png" type="image/png" height="333" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:100%;height:auto;cursor:-webkit-zoom-in;transition:all 0.25s ease-in-out;" width="700"/><br style="box-sizing:border-box;"/><div style="padding:10px;box-sizing:border-box;max-width:80%;min-height:22px;display:inline-block;min-width:20%;margin:0px auto;border-bottom:1px solid rgb(217, 217, 217);font-size:14px;color:rgb(150, 150, 150);line-height:1.7;">X86处理器对中断的支持</div>
</div><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">中断/异常的<b style="box-sizing:border-box;font-weight:700;">硬件处理过程</b>：</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">1. 确定与中断或异常关联的<b style="box-sizing:border-box;font-weight:700;">向量i</b><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">2. 通过IDTR寄存器找到IDT表，获得<b style="box-sizing:border-box;font-weight:700;">中断描述符</b>（表中的第i项）</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">3. 从GDTR寄存器获得GDT的地址；结合中断描述符中的<b style="box-sizing:border-box;font-weight:700;">段选择符</b>，在GDT表获取对应的<b style="box-sizing:border-box;font-weight:700;">段描述符</b>；从该段描述符中得到中断或异常处理程序所在的<b style="box-sizing:border-box;font-weight:700;">段基址</b></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">4. 特权级检查<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">5. 检查是否发生了特权级的变化，如果是，则进行堆栈切换(必<b style="box-sizing:border-box;font-weight:700;">须使用与新的特权级相关的栈</b>)<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">6. 硬件压栈，保存上下文环境；如果异常产生了硬件出错码，也将它保存在栈中</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">7. 如果是中断，清IF位</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">8. 通过中断描述符中的段内偏移量和段描述符中的基地址，找到中断/异常处理程序的入口地址，执行其第一条指令<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><b style="box-sizing:border-box;font-weight:700;">Summary</b>：<br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">中断，多道程序操作系统的基点，没有中断机制程序只能从头一直运行结束才有可能开始运行其他程序</p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><br style="box-sizing:border-box;"/></p><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">（完）<br style="box-sizing:border-box;"/></p>
        </div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 